# MedDRA 증상 검색 프로그램

환자의 증상을 입력하면 관련된 MedDRA 코드와 계층 정보를 출력하는 프로그램입니다.

## 📋 프로그램 구조

```
claude/
├── meddra_loader.py      # 데이터 로더 (LLT, PT, Hierarchy)
├── symptom_search.py     # 검색 엔진 및 포맷팅
├── meddra_cli.py         # 명령행 인터페이스 (실행 파일)
└── PROGRAM_README.md     # 이 파일
```

## 🚀 빠른 시작

### 1. 대화형 모드 실행 (권장)

```bash
cd claude
python meddra_cli.py
```

**사용 예시:**
```
증상 입력 > 두통
# 두통 관련 모든 코드와 계층 정보 출력

증상 입력 > detail 10019211
# PT 코드 10019211의 상세 정보 출력

증상 입력 > quit
# 종료
```

### 2. 단일 검색 모드

```bash
# 기본 검색
python meddra_cli.py -s "복통"

# 관련 증상 포함 검색
python meddra_cli.py -s "어지러움" -r
```

### 3. PT 코드로 상세 정보 조회

```bash
python meddra_cli.py -d 10019211
```

## 📖 사용 방법

### 대화형 모드 명령어

| 명령어 | 설명 | 예시 |
|--------|------|------|
| `<증상>` | 증상 검색 | `두통`, `복통`, `어지러움` |
| `detail <PT코드>` | PT 상세 정보 | `detail 10019211` |
| `help` | 도움말 표시 | `help` |
| `quit` 또는 `exit` | 종료 | `quit` |

### 명령행 옵션

```bash
python meddra_cli.py [옵션]

옵션:
  -s, --search SYMPTOM    검색할 증상 (예: "두통")
  -d, --detail PT_CODE    PT 코드로 상세 정보 조회
  -r, --related           관련 증상도 함께 표시
  -p, --path PATH         데이터 디렉토리 경로 (기본: ../ascii-281)
  -h, --help              도움말 표시
```

## 💡 사용 예제

### 예제 1: 두통 검색

```bash
python meddra_cli.py -s "두통" -r
```

**출력:**
```
======================================================================
총 5개의 결과를 찾았습니다.
======================================================================

[결과 1]
  LLT: 두통 (코드: 10019211)
  ↓
  PT:  두통 (코드: 10019211)

  📋 전체 계층 구조:
     SOC:  각종 신경계 장애 (Nerv, 10029205)
       ↓
     HLGT: 각종 두통 (10019231)
       ↓
     HLT:  두통 NEC (10019233)
       ↓
     PT:   두통 (10019211)

  🔗 관련 증상 (같은 HLT):
     • 긴장성 두통 (10027599)
     • 군발성 두통 (10027606)
     • 편두통 (10027607)
     • 외상후 두통 (10036416)

----------------------------------------------------------------------
```

### 예제 2: 복통 검색

```bash
python meddra_cli.py -s "복통"
```

**출력:**
```
======================================================================
총 3개의 결과를 찾았습니다.
======================================================================

[결과 1]
  LLT: 복통 (코드: 10000081)
  ↓
  PT:  복통 (코드: 10000081)

  📋 전체 계층 구조:
     SOC:  각종 위장관 장애 (Gastr, 10017947)
       ↓
     HLGT: 위장관 징후 및 증상 (10018012)
       ↓
     HLT:  위장관 및 복부 통증(구강 및 인후 제외) (10017926)
       ↓
     PT:   복통 (10000081)

----------------------------------------------------------------------
```

### 예제 3: PT 코드로 상세 정보 조회

```bash
python meddra_cli.py -d 10019211
```

**출력:**
```
======================================================================
PT 상세 정보: 두통 (10019211)
======================================================================

📋 Primary 계층 구조:
   SOC:  각종 신경계 장애 (Nerv, 10029205)
     ↓
   HLGT: 각종 두통 (10019231)
     ↓
   HLT:  두통 NEC (10019233)
     ↓
   PT:   두통 (10019211)

📝 관련 LLT (최하위 용어) - 총 3개:
   • 두통 (10019211)
   • 두통 NOS (10019212)
   • 편두통 이외의 두통 (10058674)

🔗 관련 증상 (같은 HLT) - 총 10개:
   • 긴장성 두통 (10027599)
   • 군발성 두통 (10027606)
   • 편두통 (10027607)
   • 외상후 두통 (10036416)
   ...

======================================================================
```

## 🔍 검색 기능

### 1. 부분 일치 검색
- 입력한 키워드가 포함된 모든 용어를 찾습니다.
- 예: "통증" → "두통", "복통", "요통" 등 모두 검색

### 2. 계층 정보 제공
- SOC (기관계)
- HLGT (상위 그룹 용어)
- HLT (상위 용어)
- PT (선호 용어) - 표준 코딩 레벨
- LLT (최하위 용어) - 검색용

### 3. 관련 증상 표시
- 같은 HLT에 속한 유사 증상들을 자동으로 제안
- `-r` 옵션 사용 시 활성화

### 4. 다중 분류 지원
- Primary SOC와 Secondary SOC 모두 표시
- 상세 정보 조회 시 확인 가능

## 🎯 주요 기능

### SymptomSearch 클래스

```python
from symptom_search import SymptomSearch

# 초기화
search = SymptomSearch(data_dir='../ascii-281')

# 증상 검색
results = search.search('두통', show_related=True)

# PT 상세 정보
details = search.get_details('10019211')
```

### 데이터 로더

```python
from meddra_loader import LLTLoader, PTLoader, HierarchyLoader

# 개별 로더 사용
llt_loader = LLTLoader('../ascii-281/llt.asc')
pt_loader = PTLoader('../ascii-281/pt.asc')
hier_loader = HierarchyLoader('../ascii-281/mdhier.asc')

# LLT 검색
llt_results = llt_loader.search_by_name('두통')

# PT 정보 조회
pt_info = pt_loader.get_pt_info('10019211')

# 계층 정보 조회
hierarchy = hier_loader.get_hierarchy('10019211')
```

## 📊 출력 정보

### 검색 결과에 포함되는 정보

1. **LLT 정보**
   - LLT 코드
   - LLT 용어명

2. **PT 정보**
   - PT 코드
   - PT 용어명

3. **계층 정보**
   - SOC (기관계) - 코드, 이름, 약어
   - HLGT (상위 그룹 용어) - 코드, 이름
   - HLT (상위 용어) - 코드, 이름
   - PT (선호 용어) - 코드, 이름

4. **관련 정보** (옵션)
   - 같은 HLT의 다른 PT들
   - 해당 PT의 모든 LLT들

## ⚙️ 시스템 요구사항

### Python 버전
- Python 3.7 이상

### 필수 파일
```
MedDRA_28_1_Korean/
├── ascii-281/
│   ├── llt.asc          # 필수
│   ├── pt.asc           # 필수
│   └── mdhier.asc       # 필수
└── claude/
    ├── meddra_loader.py
    ├── symptom_search.py
    └── meddra_cli.py
```

### 설치 방법
```bash
# 외부 라이브러리 없이 표준 라이브러리만 사용
# 별도 설치 불필요
```

## 🐛 문제 해결

### "파일을 찾을 수 없습니다" 오류

**원인:** 데이터 파일 경로가 잘못됨

**해결:**
```bash
# 현재 위치 확인
pwd

# claude 폴더에서 실행하는지 확인
cd /path/to/MedDRA_28_1_Korean/claude

# 또는 경로 지정
python meddra_cli.py -p /absolute/path/to/ascii-281
```

### 검색 결과가 없음

**원인:** 키워드가 정확하지 않거나 존재하지 않는 용어

**해결:**
- 다른 키워드로 시도 (예: "머리아픔" → "두통")
- 부분 키워드 사용 (예: "통증")
- 영문이 아닌 한글로 검색

### 한글이 깨짐

**원인:** 터미널 인코딩 문제

**해결:**
```bash
# Linux/Mac
export LANG=ko_KR.UTF-8

# Windows (PowerShell)
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
```

## 📝 자주 사용하는 증상 검색어

| 증상 분류 | 검색어 예시 |
|-----------|-------------|
| **신경계** | 두통, 어지러움, 현기증, 떨림, 마비 |
| **위장관** | 복통, 오심, 구토, 설사, 변비 |
| **호흡기** | 기침, 호흡곤란, 천식, 가래 |
| **심혈관** | 가슴통증, 심계항진, 부정맥 |
| **피부** | 발진, 두드러기, 가려움증, 홍반 |
| **전신** | 발열, 피로, 무력감, 체중감소 |

## 🔧 개발자 정보

### 프로그램 구조

```python
# 1. 데이터 로딩 (meddra_loader.py)
LLTLoader      # LLT 파일 로드 및 검색
PTLoader       # PT 파일 로드
HierarchyLoader # 계층 정보 로드

# 2. 검색 엔진 (symptom_search.py)
SymptomSearch  # 통합 검색 시스템
format_search_results  # 결과 포맷팅
format_details         # 상세 정보 포맷팅

# 3. CLI (meddra_cli.py)
interactive_mode      # 대화형 모드
single_search_mode    # 단일 검색 모드
detail_mode          # 상세 정보 모드
```

### 확장 가능성

- SMQ 검색 기능 추가 가능
- 웹 UI 개발 가능 (Flask/FastAPI)
- 데이터베이스 연동 가능
- REST API 서버 구축 가능

## 📚 참고 문서

- [00_개요.md](00_개요.md) - MedDRA 전체 개요
- [01_용어_검색.md](01_용어_검색.md) - 검색 방법 상세
- [02_계층_탐색.md](02_계층_탐색.md) - 계층 구조 설명
- [05_데이터_추출.md](05_데이터_추출.md) - 프로그래밍 가이드

## 📞 지원

문제가 발생하거나 개선 제안이 있으시면 프로젝트 관리자에게 문의하세요.

---

**버전:** 1.0.0
**마지막 업데이트:** 2025-10-14
**MedDRA 버전:** 28.1 Korean
