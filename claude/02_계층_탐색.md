# MedDRA 계층 구조 탐색 가이드

## 계층 구조 개요

MedDRA의 5단계 계층을 이해하고 탐색하는 방법을 설명합니다.

```
SOC (System Organ Class) - 27개
  ↓
HLGT (High Level Group Term) - 337개
  ↓
HLT (High Level Term) - 1,739개
  ↓
PT (Preferred Term) - 27,163개
  ↓
LLT (Lowest Level Term) - 90,471개
```

## 1. 완전한 계층 정보: mdhier.asc

### 파일 구조

**파일:** `ascii-281/mdhier.asc`

가장 중요한 파일로, PT부터 SOC까지의 완전한 계층 경로를 한 줄로 제공합니다.

**구조:**
```
pt_code$hlt_code$hlgt_code$soc_code$pt_name$hlt_name$hlgt_name$soc_name$soc_abbrev$$primary_soc_flag$
```

**필드 설명:**
- `pt_code`: PT 코드
- `hlt_code`: 해당 PT가 속한 HLT 코드
- `hlgt_code`: 해당 HLT가 속한 HLGT 코드
- `soc_code`: 해당 HLGT가 속한 SOC 코드
- `pt_name` ~ `soc_name`: 각 레벨의 한글명
- `soc_abbrev`: SOC 약어 (예: Gastr, Nerv, Card)
- `primary_soc_flag`: 주 SOC 여부 (Y/N)

### 실전 예시

#### 예제 1: "복통" (PT 10000081)의 완전한 계층

```bash
grep "^10000081\$" ascii-281/mdhier.asc
```

**결과:** (실제로는 한 줄)
```
10000081$10017926$10018012$10017947$복통$위장관 및 복부 통증(구강 및 인후 제외)$위장관 징후 및 증상$각종 위장관 장애$Gastr$$Y$
```

**계층 경로 해석:**
```
SOC:  10017947 - 각종 위장관 장애 (Gastr)
  ↓
HLGT: 10018012 - 위장관 징후 및 증상
  ↓
HLT:  10017926 - 위장관 및 복부 통증(구강 및 인후 제외)
  ↓
PT:   10000081 - 복통
```

#### 예제 2: "어지러움" (PT 10013573)의 다중 분류

```bash
grep "^10013573\$" ascii-281/mdhier.asc
```

**결과:**
```
10013573$10007609$10082206$10007541$어지러움$심장 징후 및 증상 NEC$심장 장애, 징후, 증상 NEC$각종 심장 장애$Card$$10029205$N$
10013573$10029306$10029305$10029205$어지러움$신경학적 징후 및 증상 NEC$신경학적 장애 NEC$각종 신경계 장애$Nerv$$10029205$Y$
10013573$10009193$10011954$10047065$어지러움$순환 허탈 및 쇼크$비특이성 혈압 및 혈압 감소 장애 및 쇼크$각종 혈관 장애$Vasc$$10029205$N$
```

**주의사항:**
- 하나의 PT가 여러 SOC에 속할 수 있음 (다중 분류)
- `primary_soc_flag=Y`: 주 분류 (이 경우 신경계 장애)
- `primary_soc_flag=N`: 부 분류 (심장 장애, 혈관 장애)
- 마지막 필드는 Primary SOC 코드 (10029205)

## 2. 단계별 계층 파일

### 2.1 SOC → HLGT 매핑

**파일:** `ascii-281/soc_hlgt.asc`

**구조:**
```
soc_code$hlgt_code$
```

**예시:**
```bash
grep "^10017947\$" ascii-281/soc_hlgt.asc
```

**결과:**
```
10017947$10017942$
10017947$10017943$
10017947$10017969$
10017947$10017973$
10017947$10018012$
...
```

**해석:** SOC 10017947 (각종 위장관 장애) 아래에 여러 HLGT가 속함

### 2.2 HLGT → HLT 매핑

**파일:** `ascii-281/hlgt_hlt.asc`

**구조:**
```
hlgt_code$hlt_code$
```

**예시:**
```bash
grep "^10018012\$" ascii-281/hlgt_hlt.asc
```

**결과:**
```
10018012$10017926$
10018012$10018013$
10018012$10018018$
...
```

**해석:** HLGT 10018012 (위장관 징후 및 증상) 아래에 여러 HLT가 속함

### 2.3 HLT → PT 매핑

**파일:** `ascii-281/hlt_pt.asc`

**구조:**
```
hlt_code$pt_code$
```

**예시:**
```bash
grep "^10017926\$" ascii-281/hlt_pt.asc | head -10
```

**결과:**
```
10017926$10000081$
10017926$10000084$
10017926$10000087$
10017926$10003699$
10017926$10003970$
...
```

**해석:** HLT 10017926 (위장관 및 복부 통증) 아래에 여러 PT가 속함

## 3. 계층 탐색 패턴

### 패턴 1: 상향 탐색 (PT → SOC)

**목적:** 특정 증상이 어느 신체 시스템에 속하는지 확인

```bash
# Step 1: PT 코드로 전체 계층 조회
grep "^10000081\$" ascii-281/mdhier.asc

# 결과에서 SOC 정보 확인
# 10017947 - 각종 위장관 장애
```

**활용 예시:**
- 부작용 보고서 작성 시 SOC 분류 필요
- 통계 분석 시 기관계별 그룹화

### 패턴 2: 하향 탐색 (SOC → PT)

**목적:** 특정 신체 시스템의 모든 증상 찾기

```bash
# Step 1: SOC 확인
grep "신경계" ascii-281/soc.asc
# 결과: 10029205$각종 신경계 장애$Nerv$$$$$$$$

# Step 2: 해당 SOC의 모든 PT 찾기
grep "\$10029205\$" ascii-281/mdhier.asc | grep "Y\$" | cut -d'$' -f1,5
```

**활용 예시:**
- 신경계 관련 모든 부작용 리스트 생성
- 특정 기관계 모니터링

### 패턴 3: 형제 탐색 (같은 HLT의 다른 PT)

**목적:** 유사한 증상들 찾기

```bash
# Step 1: PT의 HLT 코드 확인
grep "^10000081\$" ascii-281/mdhier.asc | cut -d'$' -f2
# 결과: 10017926

# Step 2: 같은 HLT의 모든 PT 찾기
grep "^10017926\$" ascii-281/hlt_pt.asc | cut -d'$' -f2 > pt_list.txt

# Step 3: PT 이름 확인
while read pt_code; do
    grep "^${pt_code}\$" ascii-281/pt.asc
done < pt_list.txt
```

**결과 예시:**
- 복통 (10000081)
- 하복부 통증 (10000084)
- 상복부 통증 (10000087)
- 심와부 불쾌감 (10015311)
- ...

## 4. Primary vs Secondary SOC

### Primary SOC의 중요성

하나의 PT가 여러 SOC에 속할 수 있지만, **Primary SOC**는 하나만 존재합니다.

**예시: "어지러움" (10013573)**

```
Primary SOC (Y):   각종 신경계 장애 (10029205)
Secondary SOC (N): 각종 심장 장애 (10007541)
Secondary SOC (N): 각종 혈관 장애 (10047065)
```

**Primary SOC 선택 기준:**
- 가장 빈번한 원인
- 임상적으로 가장 중요한 분류
- 규제 보고 시 기본 분류로 사용

### Primary SOC 필터링

```bash
# Primary SOC만 조회
grep "^10013573\$" ascii-281/mdhier.asc | grep "Y\$"

# 결과:
# 10013573$10029306$10029305$10029205$어지러움$...$Nerv$$10029205$Y$
```

## 5. SOC 약어 코드

### 주요 SOC 약어

| 약어 | SOC 코드 | 한글명 |
|------|----------|--------|
| **Blood** | 10005329 | 혈액 및 림프계 장애 |
| **Card** | 10007541 | 각종 심장 장애 |
| **Cong** | 10010331 | 선천성, 가족성 및 유전성 장애 |
| **Ear** | 10013993 | 귀 및 미로 장애 |
| **Endo** | 10014698 | 각종 내분비 장애 |
| **Eye** | 10015919 | 각종 눈 장애 |
| **Gastr** | 10017947 | 각종 위장관 장애 |
| **Genrl** | 10018065 | 전신 장애 및 투여 부위 병태 |
| **Hepat** | 10019805 | 간담도 장애 |
| **Immun** | 10021428 | 각종 면역계 장애 |
| **Nerv** | 10029205 | 각종 신경계 장애 |
| **Resp** | 10038738 | 호흡기, 흉곽 및 종격 장애 |
| **Skin** | 10040785 | 피부 및 피하 조직 장애 |
| **Vasc** | 10047065 | 각종 혈관 장애 |

### SOC 목록 조회

```bash
# 모든 SOC 조회
cat ascii-281/soc.asc
```

## 6. 계층 통계

### 데이터 규모

```
SOC:  27개    (기관계)
HLGT: 337개   (대분류)
HLT:  1,739개 (중분류)
PT:   27,163개 (표준 용어)
LLT:  90,471개 (검색 용어)
```

### 평균 분포 (추정)

- 1개 SOC → 약 12개 HLGT
- 1개 HLGT → 약 5개 HLT
- 1개 HLT → 약 15개 PT
- 1개 PT → 약 3-4개 LLT

## 7. 실전 계층 탐색 예시

### 시나리오: "두통" 관련 모든 용어 찾기

```bash
# Step 1: "두통" PT 찾기
grep "두통" ascii-281/pt.asc | grep "^10019211"
# 결과: 10019211$두통$$10029205$$$$$$$$

# Step 2: 계층 정보 확인
grep "^10019211\$" ascii-281/mdhier.asc
# 결과: 10019211$10019233$10019231$10029205$두통$두통 NEC$각종 두통$각종 신경계 장애$Nerv$$10029205$Y$

# Step 3: 같은 HLT (10019233 "두통 NEC")의 다른 PT 찾기
grep "^10019233\$" ascii-281/hlt_pt.asc

# Step 4: PT 이름 확인
grep "^10019233\$" ascii-281/hlt_pt.asc | cut -d'$' -f2 | while read code; do
    grep "^${code}\$" ascii-281/pt.asc | cut -d'$' -f1,2
done
```

**결과 예시:**
- 10019211$두통
- 10027599$긴장성 두통
- 10027606$군발성 두통
- 10027607$편두통
- ...

## 8. 계층 탐색 알고리즘

### Python 예시 코드

```python
def get_full_hierarchy(pt_code):
    """
    PT 코드로 완전한 계층 정보 조회
    """
    # mdhier.asc에서 조회 (Primary SOC만)
    with open('ascii-281/mdhier.asc', 'r', encoding='utf-8') as f:
        for line in f:
            fields = line.strip().split('$')
            if fields[0] == pt_code and fields[10] == 'Y':
                return {
                    'pt_code': fields[0],
                    'pt_name': fields[4],
                    'hlt_code': fields[1],
                    'hlt_name': fields[5],
                    'hlgt_code': fields[2],
                    'hlgt_name': fields[6],
                    'soc_code': fields[3],
                    'soc_name': fields[7],
                    'soc_abbrev': fields[8]
                }
    return None


def get_sibling_pts(pt_code):
    """
    같은 HLT에 속한 형제 PT들 찾기
    """
    # 1. PT의 HLT 코드 찾기
    hierarchy = get_full_hierarchy(pt_code)
    if not hierarchy:
        return []

    hlt_code = hierarchy['hlt_code']

    # 2. 같은 HLT의 모든 PT 찾기
    sibling_pts = []
    with open('ascii-281/hlt_pt.asc', 'r', encoding='utf-8') as f:
        for line in f:
            fields = line.strip().split('$')
            if fields[0] == hlt_code:
                sibling_pts.append(fields[1])

    return sibling_pts


def get_all_pts_in_soc(soc_code):
    """
    특정 SOC의 모든 PT 찾기
    """
    pts = []
    with open('ascii-281/mdhier.asc', 'r', encoding='utf-8') as f:
        for line in f:
            fields = line.strip().split('$')
            if fields[3] == soc_code and fields[10] == 'Y':
                pts.append({
                    'pt_code': fields[0],
                    'pt_name': fields[4]
                })
    return pts
```

## 9. 주의사항

### 다중 분류 처리
- 항상 Primary SOC (Y)를 기본으로 사용
- Secondary SOC는 추가 컨텍스트로만 활용

### 파일 간 일관성
- `mdhier.asc`만으로도 대부분 처리 가능
- 개별 관계 파일은 특정 레벨만 탐색할 때 유용

### 성능 최적화
- 대용량 파일이므로 인덱스 구축 권장
- Dictionary/Map 구조로 메모리 캐싱

## 다음 단계

계층 구조를 이해했다면, [03_실전_예제.md](03_실전_예제.md)에서 실제 사용 사례를 확인하세요.
